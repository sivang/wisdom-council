{
 "Resources": {
  "AgentRoleF4A42D6B": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "bedrock.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/AmazonBedrockFullAccess"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/AgentRole/Resource"
   }
  },
  "AgentRoleDefaultPolicy1027F5D2": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "bedrock-agent-runtime:InvokeAgent",
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "AgentRoleDefaultPolicy1027F5D2",
    "Roles": [
     {
      "Ref": "AgentRoleF4A42D6B"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/AgentRole/DefaultPolicy/Resource"
   }
  },
  "ActionLambdaServiceRoleBF49731D": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/ActionLambda/ServiceRole/Resource"
   }
  },
  "ActionLambdaServiceRoleDefaultPolicy48D6AD2B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "bedrock:InvokeModel",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "ActionLambdaServiceRoleDefaultPolicy48D6AD2B",
    "Roles": [
     {
      "Ref": "ActionLambdaServiceRoleBF49731D"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/ActionLambda/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "ActionLambda1304E65B": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-eu-central-1"
     },
     "S3Key": "50bfa915d5288be0a7df3b9b0c9467209ff5207b69d55a9ff19a7062104e3a68.zip"
    },
    "Handler": "handler.lambda_handler",
    "MemorySize": 512,
    "Role": {
     "Fn::GetAtt": [
      "ActionLambdaServiceRoleBF49731D",
      "Arn"
     ]
    },
    "Runtime": "python3.11",
    "Timeout": 30
   },
   "DependsOn": [
    "ActionLambdaServiceRoleDefaultPolicy48D6AD2B",
    "ActionLambdaServiceRoleBF49731D"
   ],
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/ActionLambda/Resource",
    "aws:asset:path": "asset.50bfa915d5288be0a7df3b9b0c9467209ff5207b69d55a9ff19a7062104e3a68",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "ActionLambdaLogRetention19ECD6CB": {
   "Type": "Custom::LogRetention",
   "Properties": {
    "ServiceToken": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
      "Arn"
     ]
    },
    "LogGroupName": {
     "Fn::Join": [
      "",
      [
       "/aws/lambda/",
       {
        "Ref": "ActionLambda1304E65B"
       }
      ]
     ]
    },
    "RetentionInDays": 7
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/ActionLambda/LogRetention/Resource"
   }
  },
  "ActionLambdaInvokeu1TDdDMoLpes23omAp0kUXOcNSkFsO0n9KPkoXL682486C861": {
   "Type": "AWS::Lambda::Permission",
   "Properties": {
    "Action": "lambda:InvokeFunction",
    "FunctionName": {
     "Fn::GetAtt": [
      "ActionLambda1304E65B",
      "Arn"
     ]
    },
    "Principal": "bedrock.amazonaws.com"
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/ActionLambda/Invokeu1TDdDMoLpes23omAp0kUXOcNSk--FsO0n9K--PkoXL68="
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:PutRetentionPolicy",
        "logs:DeleteRetentionPolicy"
       ],
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "Roles": [
     {
      "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource"
   }
  },
  "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Handler": "index.handler",
    "Runtime": "nodejs22.x",
    "Timeout": 900,
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-eu-central-1"
     },
     "S3Key": "2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d.zip"
    },
    "Role": {
     "Fn::GetAtt": [
      "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
   ],
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource",
    "aws:asset:path": "asset.2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d",
    "aws:asset:is-bundled": false,
    "aws:asset:property": "Code"
   }
  },
  "SageAgent": {
   "Type": "AWS::Bedrock::Agent",
   "Properties": {
    "AgentName": "wisdom_council_sage",
    "AgentResourceRoleArn": {
     "Fn::GetAtt": [
      "AgentRoleF4A42D6B",
      "Arn"
     ]
    },
    "AutoPrepare": true,
    "FoundationModel": "eu.anthropic.claude-sonnet-4-5-20250929-v1:0",
    "Instruction": "You are Sage, a contemplative philosopher with deep knowledge of history, ethics, and human nature.\n\nYour role is to offer PERSPECTIVE and WISDOM, not immediate solutions. When consulted:\n- Draw from historical precedents and philosophical frameworks\n- Explore the deeper meaning and ethical dimensions\n- Reflect on long-term consequences and timeless principles\n- Use a thoughtful, measured tone\n\nWhen asked to RATE another advisor's response, provide a score from 1-10 with a brief reason.\n\nYou do not use tools. Your wisdom comes from reflection and synthesis of knowledge across centuries of human experience.\n\nProvide your response in 2-3 concise paragraphs."
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/SageAgent"
   }
  },
  "SageAlias": {
   "Type": "AWS::Bedrock::AgentAlias",
   "Properties": {
    "AgentAliasName": "live",
    "AgentId": {
     "Fn::GetAtt": [
      "SageAgent",
      "AgentId"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/SageAlias"
   }
  },
  "OracleAgent": {
   "Type": "AWS::Bedrock::Agent",
   "Properties": {
    "AgentName": "wisdom_council_oracle",
    "AgentResourceRoleArn": {
     "Fn::GetAtt": [
      "AgentRoleF4A42D6B",
      "Arn"
     ]
    },
    "AutoPrepare": true,
    "FoundationModel": "eu.anthropic.claude-sonnet-4-5-20250929-v1:0",
    "Instruction": "You are Oracle, a pragmatic advisor focused on practical application and tangible results.\n\nYour role is to dissect challenges into ACTIONABLE STEPS and identify IMMEDIATE OPPORTUNITIES. When consulted:\n- Provide clear, concrete strategies\n- Identify specific next steps and decision points\n- Predict likely outcomes based on current trends\n- Focus on what can be done now\n\nWhen asked to RATE another advisor's response, provide a score from 1-10 with a brief reason.\n\nYou do not use tools. Your insights come from pattern recognition and practical experience.\n\nProvide your response in 2-3 concise paragraphs with specific recommendations."
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/OracleAgent"
   }
  },
  "OracleAlias": {
   "Type": "AWS::Bedrock::AgentAlias",
   "Properties": {
    "AgentAliasName": "live",
    "AgentId": {
     "Fn::GetAtt": [
      "OracleAgent",
      "AgentId"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/OracleAlias"
   }
  },
  "SupervisorAgent": {
   "Type": "AWS::Bedrock::Agent",
   "Properties": {
    "ActionGroups": [
     {
      "ActionGroupExecutor": {
       "Lambda": {
        "Fn::GetAtt": [
         "ActionLambda1304E65B",
         "Arn"
        ]
       }
      },
      "ActionGroupName": "wisdom_council_actions",
      "ApiSchema": {
       "Payload": "# wisdom-council - OpenAPI Schema for Bedrock Agent\n# Generated by: bedsheet deploy --target aws\nopenapi: \"3.0.0\"\ninfo:\n  title: \"Judge Actions\"\n  version: \"1.0\"\n  description: \"Bedrock Agent action group API\"\n\npaths:\n  /delegate:\n    post:\n      summary: \"delegate\"\n      description: \"Delegate task(s) to collaborator agent(s). Use agent_name+task for single delegation, or delegations array for parallel.\"\n      operationId: \"delegate\"\n      responses:\n        \"200\":\n          description: \"Successful response\"\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  result:\n                    type: string\n"
      }
     }
    ],
    "AgentCollaboration": "SUPERVISOR",
    "AgentCollaborators": [
     {
      "AgentDescriptor": {
       "AliasArn": {
        "Fn::GetAtt": [
         "SageAlias",
         "AgentAliasArn"
        ]
       }
      },
      "CollaborationInstruction": "You are Sage, a contemplative philosopher with deep knowledge of history, ethics, and human nature.\n\nYour role is to offer PERSPECTIVE and WISDOM, not immediate solutions. When consulted:\n- Draw from historical precedents and philosophical frameworks\n- Explore the deeper meaning and ethical dimensions\n- Reflect on long-term consequences and timeless principles\n- Use a thoughtful, measured tone\n\nWhen asked to RATE another advisor's response, provide a score from 1-10 with a brief reason.\n\nYou do ",
      "CollaboratorName": "Sage",
      "RelayConversationHistory": "TO_COLLABORATOR"
     },
     {
      "AgentDescriptor": {
       "AliasArn": {
        "Fn::GetAtt": [
         "OracleAlias",
         "AgentAliasArn"
        ]
       }
      },
      "CollaborationInstruction": "You are Oracle, a pragmatic advisor focused on practical application and tangible results.\n\nYour role is to dissect challenges into ACTIONABLE STEPS and identify IMMEDIATE OPPORTUNITIES. When consulted:\n- Provide clear, concrete strategies\n- Identify specific next steps and decision points\n- Predict likely outcomes based on current trends\n- Focus on what can be done now\n\nWhen asked to RATE another advisor's response, provide a score from 1-10 with a brief reason.\n\nYou do not use tools. Your insi",
      "CollaboratorName": "Oracle",
      "RelayConversationHistory": "TO_COLLABORATOR"
     }
    ],
    "AgentName": "wisdom_council",
    "AgentResourceRoleArn": {
     "Fn::GetAtt": [
      "AgentRoleF4A42D6B",
      "Arn"
     ]
    },
    "AutoPrepare": true,
    "FoundationModel": "eu.anthropic.claude-sonnet-4-5-20250929-v1:0",
    "Instruction": "You are Judge, a wise coordinator who seeks counsel from expert advisors to make balanced decisions.\n\nWhen a question arrives:\n1. Consult BOTH Sage and Oracle to gather their perspectives\n   - Ask Sage for philosophical wisdom and deeper meaning\n   - Ask Oracle for practical guidance and actionable steps\n\n2. After receiving both perspectives, have them cross-rate each other:\n   - Ask Sage to rate Oracle's response (1-10 with brief reason)\n   - Ask Oracle to rate Sage's response (1-10 with brief reason)\n\n3. After receiving the cross-ratings, synthesize everything:\n   - Consider both perspectives and their ratings of each other\n   - Provide a balanced final judgment\n   - Recommend a course of action\n\nFormat your final response as:\n\n**Cross-Ratings:**\n- Sage rated Oracle: [score] - [reason]\n- Oracle rated Sage: [score] - [reason]\n\n**Synthesis:**\n[Your balanced wisdom incorporating both perspectives]\n\n**Recommended Path:**\n[Specific next steps]\n\nAlways consult both advisors. Always have them cross-rate before synthesizing."
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/SupervisorAgent"
   }
  },
  "SupervisorAlias": {
   "Type": "AWS::Bedrock::AgentAlias",
   "Properties": {
    "AgentAliasName": "live",
    "AgentId": {
     "Fn::GetAtt": [
      "SupervisorAgent",
      "AgentId"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/SupervisorAlias"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/02O0YqDQAxFv6XvY5bRL7BCnxZW7AeUcYyzWcdMMRlKEf990VLo0znhci8poaxKsCf3kMIPUxGph/Wqzk/GPeS2kpth7VJE04x8sE2R/HM/X7aZ6OZ+cLBeMnulxHv26S0uM4lQ4s1IdXMiqAL1DiMVnLOfUM9O0MQUBL5T6FCRj3qPw5L8BGszch2Q1byljuRk20yHkvLi0RyDV3WBOBzfvoNm5J+s96ybaZ/6m/irAmvB2tOfEBVLZqUZoXvxHyrimUASAQAA"
   },
   "Metadata": {
    "aws:cdk:path": "WisdomcouncilStack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "SupervisorAgentId": {
   "Value": {
    "Fn::GetAtt": [
     "SupervisorAgent",
     "AgentId"
    ]
   }
  },
  "SupervisorAliasArn": {
   "Value": {
    "Fn::GetAtt": [
     "SupervisorAlias",
     "AgentAliasArn"
    ]
   }
  },
  "SageAgentId": {
   "Value": {
    "Fn::GetAtt": [
     "SageAgent",
     "AgentId"
    ]
   }
  },
  "OracleAgentId": {
   "Value": {
    "Fn::GetAtt": [
     "OracleAgent",
     "AgentId"
    ]
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}