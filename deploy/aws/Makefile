# wisdom-council - AWS Deployment
# Generated by: bedsheet deploy --target aws

.PHONY: help setup synth deploy destroy bootstrap debug-ui

REGION = eu-central-1

help:
	@echo "wisdom-council - AWS Deployment"
	@echo ""
	@echo "Commands:"
	@echo "  make setup     - Create venv and install CDK dependencies"
	@echo "  make bootstrap - Bootstrap CDK in your AWS account (run once)"
	@echo "  make synth     - Synthesize CloudFormation template"
	@echo "  make deploy    - Deploy to AWS"
	@echo "  make destroy   - Destroy all resources"
	@echo "  make debug-ui  - Start Debug UI (set BEDROCK_AGENT_ID first)"

setup:
	uv venv
	uv pip install -r pyproject.toml
	cd lambda && uv pip install -r requirements.txt --target .

bootstrap:
	cdk bootstrap aws://$(shell aws sts get-caller-identity --query Account --output text)/$(REGION)

synth:
	cdk synth

deploy:
	cdk deploy --require-approval never

destroy:
	cdk destroy --force

debug-ui:
	@if [ -z "$$BEDROCK_AGENT_ID" ]; then \
		echo "Error: BEDROCK_AGENT_ID not set"; \
		echo "Usage: BEDROCK_AGENT_ID=<agent-id> make debug-ui"; \
		echo ""; \
		echo "Find your agent ID with:"; \
		echo "  aws bedrock-agent list-agents --region $(REGION)"; \
		exit 1; \
	fi
	cd debug-ui && pip install fastapi uvicorn boto3 && python server.py